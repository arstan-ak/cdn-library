"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testData_1 = require("./testData");
const testSigner_1 = require("./testSigner");
describe('Signer', () => {
    const requestData = {
        body: { payment: 'payment', amount: 100 },
        headers: {
            Host: 'api.paymentsgateway.averspay.kg',
            'x-api-timestamp': '1636026186643',
            'x-api-key': 'h8z1TDStxu5YY2YuN8jUa9hpzIVbfkLT7kPiPiYj',
            'x-api-header': 'header value',
            'X-Forwarded-For': '54.187.127.20, 15.158.4.100',
            'X-Forwarded-Port': '443',
            'X-Forwarded-Proto': 'https',
        },
        httpMethod: 'POST',
        path: '/services',
        queryStringParameters: {
            from: '0',
            size: '10',
            test: undefined,
            best: 'тест дата',
        },
    };
    it('should successfully get http method', () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        expect(signer.getHttpMethod()).toEqual('post');
    });
    it('should fail to get headers data when header has an invalid value', () => {
        const request = {
            ...requestData,
            headers: {
                ...requestData.headers,
                'x-api-test': undefined,
            },
        };
        const signer = new testSigner_1.SignerForTest(request);
        expect(() => {
            signer.getHeadersData();
        }).toThrow(`Header 'x-api-test' contains invalid value`);
    });
    it('should fait to get headers data when empty headers provided', () => {
        const request = {
            ...requestData,
            headers: {},
        };
        const signer = new testSigner_1.SignerForTest(request);
        expect(() => {
            signer.getHeadersData();
        }).toThrow(Error(`Header 'Host' is required`));
    });
    it('should successfully get headers data when normal header provided', () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        expect(signer.getHeadersData()).toEqual('host:api.paymentsgateway.averspay.kg&x-api-header:header value&x-api-key:h8z1TDStxu5YY2YuN8jUa9hpzIVbfkLT7kPiPiYj&x-api-timestamp:1636026186643');
    });
    it('should successfully get query string params data when query string params not provided', () => {
        const request = {
            ...requestData,
            queryStringParameters: null,
        };
        const signer = new testSigner_1.SignerForTest(request);
        expect(signer.getQueryStringParamsData()).toEqual('');
    });
    it('should successfully get query string params data when query string params provided', () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        expect(signer.getQueryStringParamsData()).toEqual('best=%D1%82%D0%B5%D1%81%D1%82%20%D0%B4%D0%B0%D1%82%D0%B0&from=0&size=10&test=');
    });
    it('should successfully get encoded query string params data', () => {
        const data = {
            ...requestData,
            queryStringParameters: {
                from: '0',
                size: '10',
                test: undefined,
                best: '%D1%82%D0%B5%D1%81%D1%82%20%D0%B4%D0%B0%D1%82%D0%B0',
            },
        };
        const signer = new testSigner_1.SignerForTest(data);
        expect(signer.getQueryStringParamsData()).toEqual('best=%D1%82%D0%B5%D1%81%D1%82%20%D0%B4%D0%B0%D1%82%D0%B0&from=0&size=10&test=');
    });
    it('should successfully get simple path', () => {
        const data = { ...requestData, path: '/services/жаны-cервис' };
        const signer = new testSigner_1.SignerForTest(data);
        expect(signer.getPath()).toEqual('/services/жаны-cервис');
    });
    it('should successfully get encoded path', () => {
        const data = { ...requestData, path: '/services/%D0%B6%D0%B0%D0%BD%D1%8B-c%D0%B5%D1%80%D0%B2%D0%B8%D1%81' };
        const signer = new testSigner_1.SignerForTest(data);
        expect(signer.getPath()).toEqual('/services/жаны-cервис');
    });
    it('should successfully get json body', () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        expect(signer.getJsonBody()).toEqual('{"amount":100,"payment":"payment"}');
    });
    it('should successfully get empty string when there is no body', () => {
        const request = {
            ...requestData,
            body: null,
        };
        const signer = new testSigner_1.SignerForTest(request);
        expect(signer.getJsonBody()).toEqual('');
    });
    it('should successfully get data', () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        expect(signer.getData()).toEqual('post\n/services\nhost:api.paymentsgateway.averspay.kg&x-api-header:header value&x-api-key:h8z1TDStxu5YY2YuN8jUa9hpzIVbfkLT7kPiPiYj&x-api-timestamp:1636026186643\nbest=%D1%82%D0%B5%D1%81%D1%82%20%D0%B4%D0%B0%D1%82%D0%B0&from=0&size=10&test=\n{"amount":100,"payment":"payment"}');
    });
    it('should successfully sign', async () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        const signature = await signer.sign(testData_1.privateKey);
        expect(signature).toEqual('TiQCuWaV1WE/VDsbYKn6O0B2diji6MyZI6zjC8Q9lEdnc6KkxURnot1i874fw8q5cyBpLXO6T7dH70VpC11pT1vlrZDZe+PzGnYe27pRqwxU6KcohG5iYp5eeUjQHNaJHL/7zkJdCRu6nIj0z84xbLYMYbPBfTHPPp+viwnGqEdR4wIcjVm18Op3WKgOj5zTv2HB4ATNi31nERYN2R3/ecn+CgK8tIf6Ox3azhNJat3oIQT6Gk10wvAROLsNFKm82Px3CeT/lXO1d8UeeTMNGe8mvo7POGUrH4UJhjsa1myvpNyKeW1vF1kuSv8bFcoJfkXbiZ51gHGxpoL8MmYhlA==');
    });
    it('should successfully verify', async () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        const signature = await signer.sign(testData_1.privateKey);
        const isValid = signer.verify(testData_1.publicKey, signature);
        expect(isValid).toBeTruthy();
    });
    it('should fail to verify with incorrect signature', async () => {
        const signer = new testSigner_1.SignerForTest(requestData);
        const isValid = await signer.verify(testData_1.publicKey, testData_1.incorrectSignText);
        expect(isValid).toBeFalsy();
    });
    it('should successfully match sign with simple path and encoded path', async () => {
        const encodedPathdata = {
            ...requestData,
            path: '/services/%D0%B6%D0%B0%D0%BD%D1%8B-c%D0%B5%D1%80%D0%B2%D0%B8%D1%81',
        };
        const signer1 = new testSigner_1.SignerForTest(encodedPathdata);
        const simplePathData = { ...requestData, path: '/services/жаны-cервис' };
        const signer2 = new testSigner_1.SignerForTest(simplePathData);
        expect(await signer1.sign(testData_1.privateKey)).toEqual(await signer2.sign(testData_1.privateKey));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL19fdGVzdF9fL2luZGV4LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSx5Q0FBc0U7QUFDdEUsNkNBQXVEO0FBRXZELFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO0lBQ3RCLE1BQU0sV0FBVyxHQUFnQjtRQUMvQixJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUU7UUFDekMsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLGlDQUFpQztZQUN2QyxpQkFBaUIsRUFBRSxlQUFlO1lBQ2xDLFdBQVcsRUFBRSwwQ0FBMEM7WUFDdkQsY0FBYyxFQUFFLGNBQWM7WUFDOUIsaUJBQWlCLEVBQUUsNkJBQTZCO1lBQ2hELGtCQUFrQixFQUFFLEtBQUs7WUFDekIsbUJBQW1CLEVBQUUsT0FBTztTQUM3QjtRQUNELFVBQVUsRUFBRSxNQUFNO1FBQ2xCLElBQUksRUFBRSxXQUFXO1FBQ2pCLHFCQUFxQixFQUFFO1lBQ3JCLElBQUksRUFBRSxHQUFHO1lBQ1QsSUFBSSxFQUFFLElBQUk7WUFDVixJQUFJLEVBQUUsU0FBUztZQUNmLElBQUksRUFBRSxXQUFXO1NBQ2xCO0tBQ0YsQ0FBQztJQUVGLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7UUFDN0MsTUFBTSxNQUFNLEdBQUcsSUFBSSwwQkFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXZDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsa0VBQWtFLEVBQUUsR0FBRyxFQUFFO1FBQzFFLE1BQU0sT0FBTyxHQUFnQjtZQUMzQixHQUFHLFdBQVc7WUFDZCxPQUFPLEVBQUU7Z0JBQ1AsR0FBRyxXQUFXLENBQUMsT0FBTztn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QUcsSUFBSSwwQkFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMscUJBQVUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxxQkFBVSxDQUFDLENBQUMsQ0FBQztJQUNqRixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogTG9jYWwgZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBSZXF1ZXN0RGF0YSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IGluY29ycmVjdFNpZ25UZXh0LCBwcml2YXRlS2V5LCBwdWJsaWNLZXkgfSBmcm9tICcuL3Rlc3REYXRhJztcbmltcG9ydCB7IFNpZ25lckZvclRlc3QgYXMgU2lnbmVyIH0gZnJvbSAnLi90ZXN0U2lnbmVyJztcblxuZGVzY3JpYmUoJ1NpZ25lcicsICgpID0+IHtcbiAgY29uc3QgcmVxdWVzdERhdGE6IFJlcXVlc3REYXRhID0ge1xuICAgIGJvZHk6IHsgcGF5bWVudDogJ3BheW1lbnQnLCBhbW91bnQ6IDEwMCB9LFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEhvc3Q6ICdhcGkucGF5bWVudHNnYXRld2F5LmF2ZXJzcGF5LmtnJyxcbiAgICAgICd4LWFwaS10aW1lc3RhbXAnOiAnMTYzNjAyNjE4NjY0MycsXG4gICAgICAneC1hcGkta2V5JzogJ2g4ejFURFN0eHU1WVkyWXVOOGpVYTlocHpJVmJma0xUN2tQaVBpWWonLFxuICAgICAgJ3gtYXBpLWhlYWRlcic6ICdoZWFkZXIgdmFsdWUnLFxuICAgICAgJ1gtRm9yd2FyZGVkLUZvcic6ICc1NC4xODcuMTI3LjIwLCAxNS4xNTguNC4xMDAnLFxuICAgICAgJ1gtRm9yd2FyZGVkLVBvcnQnOiAnNDQzJyxcbiAgICAgICdYLUZvcndhcmRlZC1Qcm90byc6ICdodHRwcycsXG4gICAgfSxcbiAgICBodHRwTWV0aG9kOiAnUE9TVCcsXG4gICAgcGF0aDogJy9zZXJ2aWNlcycsXG4gICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7XG4gICAgICBmcm9tOiAnMCcsXG4gICAgICBzaXplOiAnMTAnLFxuICAgICAgdGVzdDogdW5kZWZpbmVkLFxuICAgICAgYmVzdDogJ9GC0LXRgdGCINC00LDRgtCwJyxcbiAgICB9LFxuICB9O1xuXG4gIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGdldCBodHRwIG1ldGhvZCcsICgpID0+IHtcbiAgICBjb25zdCBzaWduZXIgPSBuZXcgU2lnbmVyKHJlcXVlc3REYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0SHR0cE1ldGhvZCgpKS50b0VxdWFsKCdwb3N0Jyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmFpbCB0byBnZXQgaGVhZGVycyBkYXRhIHdoZW4gaGVhZGVyIGhhcyBhbiBpbnZhbGlkIHZhbHVlJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3Q6IFJlcXVlc3REYXRhID0ge1xuICAgICAgLi4ucmVxdWVzdERhdGEsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLnJlcXVlc3REYXRhLmhlYWRlcnMsXG4gICAgICAgICd4LWFwaS10ZXN0JzogdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihyZXF1ZXN0KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBzaWduZXIuZ2V0SGVhZGVyc0RhdGEoKTtcbiAgICB9KS50b1Rocm93KGBIZWFkZXIgJ3gtYXBpLXRlc3QnIGNvbnRhaW5zIGludmFsaWQgdmFsdWVgKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmYWl0IHRvIGdldCBoZWFkZXJzIGRhdGEgd2hlbiBlbXB0eSBoZWFkZXJzIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3Q6IFJlcXVlc3REYXRhID0ge1xuICAgICAgLi4ucmVxdWVzdERhdGEsXG4gICAgICBoZWFkZXJzOiB7fSxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihyZXF1ZXN0KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBzaWduZXIuZ2V0SGVhZGVyc0RhdGEoKTtcbiAgICB9KS50b1Rocm93KEVycm9yKGBIZWFkZXIgJ0hvc3QnIGlzIHJlcXVpcmVkYCkpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBnZXQgaGVhZGVycyBkYXRhIHdoZW4gbm9ybWFsIGhlYWRlciBwcm92aWRlZCcsICgpID0+IHtcbiAgICBjb25zdCBzaWduZXIgPSBuZXcgU2lnbmVyKHJlcXVlc3REYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0SGVhZGVyc0RhdGEoKSkudG9FcXVhbChcbiAgICAgICdob3N0OmFwaS5wYXltZW50c2dhdGV3YXkuYXZlcnNwYXkua2cmeC1hcGktaGVhZGVyOmhlYWRlciB2YWx1ZSZ4LWFwaS1rZXk6aDh6MVREU3R4dTVZWTJZdU44alVhOWhweklWYmZrTFQ3a1BpUGlZaiZ4LWFwaS10aW1lc3RhbXA6MTYzNjAyNjE4NjY0MydcbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBnZXQgcXVlcnkgc3RyaW5nIHBhcmFtcyBkYXRhIHdoZW4gcXVlcnkgc3RyaW5nIHBhcmFtcyBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdDogUmVxdWVzdERhdGEgPSB7XG4gICAgICAuLi5yZXF1ZXN0RGF0YSxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogbnVsbCxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihyZXF1ZXN0KTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0UXVlcnlTdHJpbmdQYXJhbXNEYXRhKCkpLnRvRXF1YWwoJycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBnZXQgcXVlcnkgc3RyaW5nIHBhcmFtcyBkYXRhIHdoZW4gcXVlcnkgc3RyaW5nIHBhcmFtcyBwcm92aWRlZCcsICgpID0+IHtcbiAgICBjb25zdCBzaWduZXIgPSBuZXcgU2lnbmVyKHJlcXVlc3REYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0UXVlcnlTdHJpbmdQYXJhbXNEYXRhKCkpLnRvRXF1YWwoXG4gICAgICAnYmVzdD0lRDElODIlRDAlQjUlRDElODElRDElODIlMjAlRDAlQjQlRDAlQjAlRDElODIlRDAlQjAmZnJvbT0wJnNpemU9MTAmdGVzdD0nXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgZ2V0IGVuY29kZWQgcXVlcnkgc3RyaW5nIHBhcmFtcyBkYXRhJywgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAuLi5yZXF1ZXN0RGF0YSxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczoge1xuICAgICAgICBmcm9tOiAnMCcsXG4gICAgICAgIHNpemU6ICcxMCcsXG4gICAgICAgIHRlc3Q6IHVuZGVmaW5lZCxcbiAgICAgICAgYmVzdDogJyVEMSU4MiVEMCVCNSVEMSU4MSVEMSU4MiUyMCVEMCVCNCVEMCVCMCVEMSU4MiVEMCVCMCcsXG4gICAgICB9LFxuICAgIH07XG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihkYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0UXVlcnlTdHJpbmdQYXJhbXNEYXRhKCkpLnRvRXF1YWwoXG4gICAgICAnYmVzdD0lRDElODIlRDAlQjUlRDElODElRDElODIlMjAlRDAlQjQlRDAlQjAlRDElODIlRDAlQjAmZnJvbT0wJnNpemU9MTAmdGVzdD0nXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgZ2V0IHNpbXBsZSBwYXRoJywgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSB7IC4uLnJlcXVlc3REYXRhLCBwYXRoOiAnL3NlcnZpY2VzL9C20LDQvdGLLWPQtdGA0LLQuNGBJyB9O1xuXG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihkYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0UGF0aCgpKS50b0VxdWFsKCcvc2VydmljZXMv0LbQsNC90YstY9C10YDQstC40YEnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgZ2V0IGVuY29kZWQgcGF0aCcsICgpID0+IHtcbiAgICBjb25zdCBkYXRhID0geyAuLi5yZXF1ZXN0RGF0YSwgcGF0aDogJy9zZXJ2aWNlcy8lRDAlQjYlRDAlQjAlRDAlQkQlRDElOEItYyVEMCVCNSVEMSU4MCVEMCVCMiVEMCVCOCVEMSU4MScgfTtcblxuICAgIGNvbnN0IHNpZ25lciA9IG5ldyBTaWduZXIoZGF0YSk7XG5cbiAgICBleHBlY3Qoc2lnbmVyLmdldFBhdGgoKSkudG9FcXVhbCgnL3NlcnZpY2VzL9C20LDQvdGLLWPQtdGA0LLQuNGBJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGdldCBqc29uIGJvZHknLCAoKSA9PiB7XG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihyZXF1ZXN0RGF0YSk7XG5cbiAgICBleHBlY3Qoc2lnbmVyLmdldEpzb25Cb2R5KCkpLnRvRXF1YWwoJ3tcImFtb3VudFwiOjEwMCxcInBheW1lbnRcIjpcInBheW1lbnRcIn0nKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgZ2V0IGVtcHR5IHN0cmluZyB3aGVuIHRoZXJlIGlzIG5vIGJvZHknLCAoKSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdDogUmVxdWVzdERhdGEgPSB7XG4gICAgICAuLi5yZXF1ZXN0RGF0YSxcbiAgICAgIGJvZHk6IG51bGwsXG4gICAgfTtcblxuICAgIGNvbnN0IHNpZ25lciA9IG5ldyBTaWduZXIocmVxdWVzdCk7XG5cbiAgICBleHBlY3Qoc2lnbmVyLmdldEpzb25Cb2R5KCkpLnRvRXF1YWwoJycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBnZXQgZGF0YScsICgpID0+IHtcbiAgICBjb25zdCBzaWduZXIgPSBuZXcgU2lnbmVyKHJlcXVlc3REYXRhKTtcblxuICAgIGV4cGVjdChzaWduZXIuZ2V0RGF0YSgpKS50b0VxdWFsKFxuICAgICAgJ3Bvc3RcXG4vc2VydmljZXNcXG5ob3N0OmFwaS5wYXltZW50c2dhdGV3YXkuYXZlcnNwYXkua2cmeC1hcGktaGVhZGVyOmhlYWRlciB2YWx1ZSZ4LWFwaS1rZXk6aDh6MVREU3R4dTVZWTJZdU44alVhOWhweklWYmZrTFQ3a1BpUGlZaiZ4LWFwaS10aW1lc3RhbXA6MTYzNjAyNjE4NjY0M1xcbmJlc3Q9JUQxJTgyJUQwJUI1JUQxJTgxJUQxJTgyJTIwJUQwJUI0JUQwJUIwJUQxJTgyJUQwJUIwJmZyb209MCZzaXplPTEwJnRlc3Q9XFxue1wiYW1vdW50XCI6MTAwLFwicGF5bWVudFwiOlwicGF5bWVudFwifSdcbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBzaWduJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHNpZ25lciA9IG5ldyBTaWduZXIocmVxdWVzdERhdGEpO1xuXG4gICAgY29uc3Qgc2lnbmF0dXJlID0gYXdhaXQgc2lnbmVyLnNpZ24ocHJpdmF0ZUtleSk7XG5cbiAgICBleHBlY3Qoc2lnbmF0dXJlKS50b0VxdWFsKFxuICAgICAgJ1RpUUN1V2FWMVdFL1ZEc2JZS242TzBCMmRpamk2TXlaSTZ6akM4UTlsRWRuYzZLa3hVUm5vdDFpODc0Znc4cTVjeUJwTFhPNlQ3ZEg3MFZwQzExcFQxdmxyWkRaZStQekduWWUyN3BScXd4VTZLY29oRzVpWXA1ZWVValFITmFKSEwvN3prSmRDUnU2bklqMHo4NHhiTFlNWWJQQmZUSFBQcCt2aXduR3FFZFI0d0ljalZtMThPcDNXS2dPajV6VHYySEI0QVROaTMxbkVSWU4yUjMvZWNuK0NnSzh0SWY2T3gzYXpoTkphdDNvSVFUNkdrMTB3dkFST0xzTkZLbTgyUHgzQ2VUL2xYTzFkOFVlZVRNTkdlOG12bzdQT0dVckg0VUpoanNhMW15dnBOeUtlVzF2RjFrdVN2OGJGY29KZmtYYmlaNTFnSEd4cG9MOE1tWWhsQT09J1xuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHZlcmlmeScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBzaWduZXIgPSBuZXcgU2lnbmVyKHJlcXVlc3REYXRhKTtcblxuICAgIGNvbnN0IHNpZ25hdHVyZSA9IGF3YWl0IHNpZ25lci5zaWduKHByaXZhdGVLZXkpO1xuXG4gICAgY29uc3QgaXNWYWxpZCA9IHNpZ25lci52ZXJpZnkocHVibGljS2V5LCBzaWduYXR1cmUpO1xuXG4gICAgZXhwZWN0KGlzVmFsaWQpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGluY29ycmVjdCBzaWduYXR1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc2lnbmVyID0gbmV3IFNpZ25lcihyZXF1ZXN0RGF0YSk7XG5cbiAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgc2lnbmVyLnZlcmlmeShwdWJsaWNLZXksIGluY29ycmVjdFNpZ25UZXh0KTtcblxuICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlRmFsc3koKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgbWF0Y2ggc2lnbiB3aXRoIHNpbXBsZSBwYXRoIGFuZCBlbmNvZGVkIHBhdGgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZW5jb2RlZFBhdGhkYXRhID0ge1xuICAgICAgLi4ucmVxdWVzdERhdGEsXG4gICAgICBwYXRoOiAnL3NlcnZpY2VzLyVEMCVCNiVEMCVCMCVEMCVCRCVEMSU4Qi1jJUQwJUI1JUQxJTgwJUQwJUIyJUQwJUI4JUQxJTgxJyxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2lnbmVyMSA9IG5ldyBTaWduZXIoZW5jb2RlZFBhdGhkYXRhKTtcblxuICAgIGNvbnN0IHNpbXBsZVBhdGhEYXRhID0geyAuLi5yZXF1ZXN0RGF0YSwgcGF0aDogJy9zZXJ2aWNlcy/QttCw0L3Riy1j0LXRgNCy0LjRgScgfTtcblxuICAgIGNvbnN0IHNpZ25lcjIgPSBuZXcgU2lnbmVyKHNpbXBsZVBhdGhEYXRhKTtcblxuICAgIGV4cGVjdChhd2FpdCBzaWduZXIxLnNpZ24ocHJpdmF0ZUtleSkpLnRvRXF1YWwoYXdhaXQgc2lnbmVyMi5zaWduKHByaXZhdGVLZXkpKTtcbiAgfSk7XG59KTtcbiJdfQ==