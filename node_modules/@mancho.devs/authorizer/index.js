"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Signer = void 0;
/* External dependencies */
const crypto_1 = require("crypto");
const node_jose_1 = require("node-jose");
class Signer {
    requestData;
    constructor(requestData) {
        console.log('request data:', requestData);
        this.requestData = requestData;
    }
    getHttpMethod() {
        return this.requestData.httpMethod.toLowerCase();
    }
    getPath() {
        return decodeURI(this.requestData.path ?? '');
    }
    getHeadersData() {
        const { headers } = this.requestData;
        const { Host } = headers;
        if (!Host) {
            throw new Error(`Header 'Host' is required`);
        }
        const headerData = `host:${Host.toString()}`;
        const sortedHeadersKeys = Object.keys(headers)
            .filter((key) => key.toLowerCase().startsWith('x-api-'))
            .sort();
        const headersData = sortedHeadersKeys.map((key) => {
            const value = headers[key];
            if (typeof value === 'undefined' || value === null || typeof value.toString !== 'function') {
                throw new Error(`Header '${key}' contains invalid value`);
            }
            const headerData = key.toLowerCase() + ':' + value.toString();
            return headerData;
        });
        return [headerData, ...headersData].join('&');
    }
    getQueryStringParamsData() {
        const queryParams = this.requestData.queryStringParameters ?? {};
        const sortedQueryParamKeys = Object.keys(queryParams).sort();
        const queryParamsData = sortedQueryParamKeys.map((key) => {
            const value = queryParams[key] ?? '';
            const queryParamData = encodeURI(decodeURI(key)) + '=' + encodeURI(decodeURI(value));
            return queryParamData;
        });
        return queryParamsData.join('&');
    }
    getJsonBody() {
        let body = '';
        if (this.requestData.body) {
            // sort object by key
            const sortedBody = Object.entries(this.requestData.body)
                .sort((a, b) => a[0].localeCompare(b[0]))
                .reduce((result, [key, value]) => {
                result[key] = value;
                return result;
            }, {});
            body = JSON.stringify(sortedBody);
        }
        return body;
    }
    getData() {
        const parts = [];
        const queryString = this.getQueryStringParamsData();
        parts.push(this.getHttpMethod());
        parts.push(this.getPath());
        parts.push(this.getHeadersData());
        if (queryString) {
            parts.push(queryString);
        }
        parts.push(this.getJsonBody());
        return parts.join('\n');
    }
    async sign(privateKey) {
        const keyStore = node_jose_1.JWK.createKeyStore();
        const rsaKey = await keyStore.add(privateKey, 'pem');
        const signer = (0, crypto_1.createSign)('SHA256');
        const data = this.getData();
        console.log('Data to be signed:', data);
        signer.update(data);
        const signature = signer.sign(rsaKey.toPEM(true), 'base64');
        return signature;
    }
    async verify(publicKey, signature) {
        const keyStore = node_jose_1.JWK.createKeyStore();
        const rsaKey = await keyStore.add(publicKey, 'pem');
        const signer = (0, crypto_1.createVerify)('SHA256');
        const data = this.getData();
        console.log('Data to be verified:', data);
        signer.update(data);
        const isValid = signer.verify(rsaKey.toPEM(), signature, 'base64');
        return isValid;
    }
}
exports.Signer = Signer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQkFBMkI7QUFDM0IsbUNBQWtEO0FBQ2xELHlDQUFnQztBQUtoQyxNQUFhLE1BQU07SUFDVCxXQUFXLENBQWM7SUFFakMsWUFBWSxXQUF3QjtRQUNsQyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUUxQyxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztJQUNqQyxDQUFDO0lBRVMsYUFBYTtRQUNyQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ25ELENBQUM7SUFFUyxPQUFPO1FBQ2YsT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVTLGNBQWM7UUFDdEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFFckMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQztRQUV6QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDVixNQUFNLElBQUksS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7UUFDL0MsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLFFBQVEsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUM7UUFFN0MsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUMzQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDdkQsSUFBSSxFQUFFLENBQUM7UUFFVixNQUFNLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFH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RXBCLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVuRSxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0NBQ0Y7QUF2SUQsd0JBdUlDIiwic291cmNlc0NvbnRlbnQiOlsiLyogRXh0ZXJuYWwgZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBjcmVhdGVTaWduLCBjcmVhdGVWZXJpZnkgfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgSldLIH0gZnJvbSAnbm9kZS1qb3NlJztcblxuLyogTG9jYWwgZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBCb2R5LCBSZXF1ZXN0RGF0YSB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgU2lnbmVyIHtcbiAgcHJpdmF0ZSByZXF1ZXN0RGF0YTogUmVxdWVzdERhdGE7XG5cbiAgY29uc3RydWN0b3IocmVxdWVzdERhdGE6IFJlcXVlc3REYXRhKSB7XG4gICAgY29uc29sZS5sb2coJ3JlcXVlc3QgZGF0YTonLCByZXF1ZXN0RGF0YSk7XG5cbiAgICB0aGlzLnJlcXVlc3REYXRhID0gcmVxdWVzdERhdGE7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SHR0cE1ldGhvZCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0RGF0YS5odHRwTWV0aG9kLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0UGF0aCgpIHtcbiAgICByZXR1cm4gZGVjb2RlVVJJKHRoaXMucmVxdWVzdERhdGEucGF0aCA/PyAnJyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SGVhZGVyc0RhdGEoKSB7XG4gICAgY29uc3QgeyBoZWFkZXJzIH0gPSB0aGlzLnJlcXVlc3REYXRhO1xuXG4gICAgY29uc3QgeyBIb3N0IH0gPSBoZWFkZXJzO1xuXG4gICAgaWYgKCFIb3N0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhlYWRlciAnSG9zdCcgaXMgcmVxdWlyZWRgKTtcbiAgICB9XG5cbiAgICBjb25zdCBoZWFkZXJEYXRhID0gYGhvc3Q6JHtIb3N0LnRvU3RyaW5nKCl9YDtcblxuICAgIGNvbnN0IHNvcnRlZEhlYWRlcnNLZXlzID0gT2JqZWN0LmtleXMoaGVhZGVycylcbiAgICAgIC5maWx0ZXIoKGtleSkgPT4ga2V5LnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgneC1hcGktJykpXG4gICAgICAuc29ydCgpO1xuXG4gICAgY29uc3QgaGVhZGVyc0RhdGEgPSBzb3J0ZWRIZWFkZXJzS2V5cy5tYXAoKGtleSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBoZWFkZXJzW2tleV07XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZS50b1N0cmluZyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhlYWRlciAnJHtrZXl9JyBjb250YWlucyBpbnZhbGlkIHZhbHVlYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhlYWRlckRhdGEgPSBrZXkudG9Mb3dlckNhc2UoKSArICc6JyArIHZhbHVlLnRvU3RyaW5nKCk7XG5cbiAgICAgIHJldHVybiBoZWFkZXJEYXRhO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIFtoZWFkZXJEYXRhLCAuLi5oZWFkZXJzRGF0YV0uam9pbignJicpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFF1ZXJ5U3RyaW5nUGFyYW1zRGF0YSgpIHtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHRoaXMucmVxdWVzdERhdGEucXVlcnlTdHJpbmdQYXJhbWV0ZXJzID8/IHt9O1xuXG4gICAgY29uc3Qgc29ydGVkUXVlcnlQYXJhbUtleXMgPSBPYmplY3Qua2V5cyhxdWVyeVBhcmFtcykuc29ydCgpO1xuXG4gICAgY29uc3QgcXVlcnlQYXJhbXNEYXRhID0gc29ydGVkUXVlcnlQYXJhbUtleXMubWFwKChrZXkpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcXVlcnlQYXJhbXNba2V5XSA/PyAnJztcblxuICAgICAgY29uc3QgcXVlcnlQYXJhbURhdGEgPSBlbmNvZGVVUkkoZGVjb2RlVVJJKGtleSkpICsgJz0nICsgZW5jb2RlVVJJKGRlY29kZVVSSSh2YWx1ZSkpO1xuXG4gICAgICByZXR1cm4gcXVlcnlQYXJhbURhdGE7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcXVlcnlQYXJhbXNEYXRhLmpvaW4oJyYnKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRKc29uQm9keSgpIHtcbiAgICBsZXQgYm9keSA9ICcnO1xuXG4gICAgaWYgKHRoaXMucmVxdWVzdERhdGEuYm9keSkge1xuICAgICAgLy8gc29ydCBvYmplY3QgYnkga2V5XG4gICAgICBjb25zdCBzb3J0ZWRCb2R5ID0gT2JqZWN0LmVudHJpZXModGhpcy5yZXF1ZXN0RGF0YS5ib2R5KVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYVswXS5sb2NhbGVDb21wYXJlKGJbMF0pKVxuICAgICAgICAucmVkdWNlKChyZXN1bHQsIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG5cbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LCB7fSBhcyBCb2R5KTtcblxuICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KHNvcnRlZEJvZHkpO1xuICAgIH1cblxuICAgIHJldHVybiBib2R5O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldERhdGEoKSB7XG4gICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdCBxdWVyeVN0cmluZyA9IHRoaXMuZ2V0UXVlcnlTdHJpbmdQYXJhbXNEYXRhKCk7XG5cbiAgICBwYXJ0cy5wdXNoKHRoaXMuZ2V0SHR0cE1ldGhvZCgpKTtcbiAgICBwYXJ0cy5wdXNoKHRoaXMuZ2V0UGF0aCgpKTtcbiAgICBwYXJ0cy5wdXNoKHRoaXMuZ2V0SGVhZGVyc0RhdGEoKSk7XG5cbiAgICBpZiAocXVlcnlTdHJpbmcpIHtcbiAgICAgIHBhcnRzLnB1c2gocXVlcnlTdHJpbmcpO1xuICAgIH1cblxuICAgIHBhcnRzLnB1c2godGhpcy5nZXRKc29uQm9keSgpKTtcblxuICAgIHJldHVybiBwYXJ0cy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIGFzeW5jIHNpZ24ocHJpdmF0ZUtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBrZXlTdG9yZSA9IEpXSy5jcmVhdGVLZXlTdG9yZSgpO1xuXG4gICAgY29uc3QgcnNhS2V5ID0gYXdhaXQga2V5U3RvcmUuYWRkKHByaXZhdGVLZXksICdwZW0nKTtcblxuICAgIGNvbnN0IHNpZ25lciA9IGNyZWF0ZVNpZ24oJ1NIQTI1NicpO1xuXG4gICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0RGF0YSgpO1xuXG4gICAgY29uc29sZS5sb2coJ0RhdGEgdG8gYmUgc2lnbmVkOicsIGRhdGEpO1xuXG4gICAgc2lnbmVyLnVwZGF0ZShkYXRhKTtcblxuICAgIGNvbnN0IHNpZ25hdHVyZSA9IHNpZ25lci5zaWduKHJzYUtleS50b1BFTSh0cnVlKSwgJ2Jhc2U2NCcpO1xuXG4gICAgcmV0dXJuIHNpZ25hdHVyZTtcbiAgfVxuXG4gIGFzeW5jIHZlcmlmeShwdWJsaWNLZXk6IHN0cmluZywgc2lnbmF0dXJlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBrZXlTdG9yZSA9IEpXSy5jcmVhdGVLZXlTdG9yZSgpO1xuXG4gICAgY29uc3QgcnNhS2V5ID0gYXdhaXQga2V5U3RvcmUuYWRkKHB1YmxpY0tleSwgJ3BlbScpO1xuXG4gICAgY29uc3Qgc2lnbmVyID0gY3JlYXRlVmVyaWZ5KCdTSEEyNTYnKTtcblxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldERhdGEoKTtcblxuICAgIGNvbnNvbGUubG9nKCdEYXRhIHRvIGJlIHZlcmlmaWVkOicsIGRhdGEpO1xuXG4gICAgc2lnbmVyLnVwZGF0ZShkYXRhKTtcblxuICAgIGNvbnN0IGlzVmFsaWQgPSBzaWduZXIudmVyaWZ5KHJzYUtleS50b1BFTSgpLCBzaWduYXR1cmUsICdiYXNlNjQnKTtcblxuICAgIHJldHVybiBpc1ZhbGlkO1xuICB9XG59XG4iXX0=